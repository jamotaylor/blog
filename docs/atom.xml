<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>James Newton Taylor</title>
  
  <subtitle>Developer // Designer</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://jamotaylor.github.io/blog/"/>
  <updated>2019-02-05T14:50:06.522Z</updated>
  <id>https://jamotaylor.github.io/blog/</id>
  
  <author>
    <name>James Newton Taylor</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Serializing *Specified Fields in .NET</title>
    <link href="https://jamotaylor.github.io/blog/2019/02/04/serializing-specified-fields/"/>
    <id>https://jamotaylor.github.io/blog/2019/02/04/serializing-specified-fields/</id>
    <published>2019-02-04T13:08:00.000Z</published>
    <updated>2019-02-05T14:50:06.522Z</updated>
    
    <content type="html"><![CDATA[<p>So I had an issue at work this week with some of our serialized fields missing (and yes, I do spell serialized the American way).  Turns out it was a very sneaky little thing indeed…</p><p>As far as serialization goes in .NET, I’m used to using attributes to specify fields which should be ignored or serialized with special conditions (e.g. the <em>[System.Xml.Serialization.XmlIgnore]</em> attribute), I had no idea about this sneaky convention:</p><blockquote><p>When you have a property in a class (e.g. <em>Name</em>) and a corresponding <strong>boolean</strong> property that <strong>ends with “Specified”</strong> (e.g. <em>NameSpecified</em>), the first property <strong>will not be serialized</strong> unless the <strong>*Specified</strong> property is set to <strong>true</strong>.</p></blockquote><p>This works for both JSON.NET and the built in <em>System.Xml.Serialization.XmlSerializer</em>, and I’m sure there are a bunch of other libraries where the convention is used.</p><p>There is a post about this on <a href="https://stackoverflow.com/questions/6711906/net-why-must-i-use-specified-property-to-force-serialization-is-there-a-way" target="_blank" rel="noopener">Stack Overflow</a>, but it didn’t go into enough detail for me, and I wasn’t sure whether this was an actual convention or something that was achieved through attributes or some other magic.</p><p>In order to test it out, I created a little… uh… test.</p><h2 id="The-Serialization-Tests"><a href="#The-Serialization-Tests" class="headerlink" title="The Serialization Tests"></a>The Serialization Tests</h2><p>Let’s start with a simple <a href="https://en.wikipedia.org/wiki/Passive_data_structure" target="_blank" rel="noopener">POD</a> class:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">jnt.Serialization</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Message</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> MessageType &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> MessageTypeSpecified &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> MessageCode &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> MessageCodeSpecified &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As you can, see, no attributes, no Data Members or Data Contracts, nothing fancy - just plain old public properties.</p><p>Now to write some basic serialization and some tests - again, the serialization is standard, out-of-box functionality.</p><h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><h4 id="The-XML-serializer"><a href="#The-XML-serializer" class="headerlink" title="The XML serializer"></a>The XML serializer</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">jnt.Serialization</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">XmlSerializer</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Serialize&lt;T&gt;(T toSerialize)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> serializer = <span class="keyword">new</span> System.Xml.Serialization.XmlSerializer(<span class="keyword">typeof</span>(T));</span><br><span class="line">      <span class="keyword">var</span> sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      <span class="keyword">using</span> (<span class="keyword">var</span> xmlWriter = XmlWriter.Create(sb, <span class="keyword">new</span> XmlWriterSettings &#123; Indent = <span class="literal">true</span> &#125;))</span><br><span class="line">      &#123;</span><br><span class="line">        serializer.Serialize(xmlWriter, toSerialize);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> sb.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="The-XML-serializer-tests"><a href="#The-XML-serializer-tests" class="headerlink" title="The XML serializer tests"></a>The XML serializer tests</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.VisualStudio.TestTools.UnitTesting;</span><br><span class="line"><span class="keyword">using</span> jnt.Serialization;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">jnt.RandomTests</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">TestClass</span>]</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">XmlSerializer_Tests</span></span><br><span class="line">  &#123;</span><br><span class="line">    [<span class="meta">TestMethod</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_Without_Specified</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      <span class="keyword">var</span> message = <span class="keyword">new</span> Message</span><br><span class="line">      &#123;</span><br><span class="line">        MessageCode = <span class="number">1234567890</span>,</span><br><span class="line">        MessageType = <span class="string">"Save Our Souls"</span></span><br><span class="line">      &#125;;</span><br><span class="line">      Console.WriteLine(<span class="keyword">new</span> XmlSerializer().Serialize(message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">TestMethod</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_With_Specified</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      <span class="keyword">var</span> message = <span class="keyword">new</span> Message</span><br><span class="line">      &#123;</span><br><span class="line">        MessageCode = <span class="number">1234567890</span>,</span><br><span class="line">        MessageCodeSpecified = <span class="literal">true</span>,</span><br><span class="line">        MessageType = <span class="string">"Save Our Souls"</span>,</span><br><span class="line">        MessageTypeSpecified = <span class="literal">true</span></span><br><span class="line">      &#125;;</span><br><span class="line">      Console.WriteLine(<span class="keyword">new</span> XmlSerializer().Serialize(message));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="XML-result-with-Specified-properties-true"><a href="#XML-result-with-Specified-properties-true" class="headerlink" title="XML result with Specified properties true*"></a>XML result with <em>Specified properties </em>true*</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-16"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Message</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MessageType</span>&gt;</span>Save Our Souls<span class="tag">&lt;/<span class="name">MessageType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MessageTypeSpecified</span>&gt;</span>true<span class="tag">&lt;/<span class="name">MessageTypeSpecified</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MessageCode</span>&gt;</span>1234567890<span class="tag">&lt;/<span class="name">MessageCode</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MessageCodeSpecified</span>&gt;</span>true<span class="tag">&lt;/<span class="name">MessageCodeSpecified</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Message</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="XML-result-with-Specified-properties-false"><a href="#XML-result-with-Specified-properties-false" class="headerlink" title="XML result with Specified properties false*"></a>XML result with <em>Specified properties </em>false*</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-16"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Message</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MessageTypeSpecified</span>&gt;</span>false<span class="tag">&lt;/<span class="name">MessageTypeSpecified</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MessageCodeSpecified</span>&gt;</span>false<span class="tag">&lt;/<span class="name">MessageCodeSpecified</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Message</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><h4 id="The-JSON-serializer"><a href="#The-JSON-serializer" class="headerlink" title="The JSON serializer"></a>The JSON serializer</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">jnt.Serialization</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JsonSerializer</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Serialize</span>(<span class="params"><span class="keyword">object</span> toSerialize</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      <span class="keyword">return</span> JsonConvert.SerializeObject(toSerialize, Formatting.Indented);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JSON-serializer-tests"><a href="#JSON-serializer-tests" class="headerlink" title="JSON serializer tests"></a>JSON serializer tests</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> jnt.Serialization;</span><br><span class="line"><span class="keyword">using</span> Microsoft.VisualStudio.TestTools.UnitTesting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">jnt.RandomTests</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">TestClass</span>]</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JsonSerializer_Tests</span></span><br><span class="line">  &#123;</span><br><span class="line">    [<span class="meta">TestMethod</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_Without_Specified</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      <span class="keyword">var</span> message = <span class="keyword">new</span> Message</span><br><span class="line">      &#123;</span><br><span class="line">        MessageCode = <span class="number">1234567890</span>,</span><br><span class="line">        MessageType = <span class="string">"Save Our Souls"</span></span><br><span class="line">      &#125;;</span><br><span class="line">      Console.WriteLine(<span class="keyword">new</span> JsonSerializer().Serialize(message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">TestMethod</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test_With_Specified</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      <span class="keyword">var</span> message = <span class="keyword">new</span> Message</span><br><span class="line">      &#123;</span><br><span class="line">        MessageCode = <span class="number">1234567890</span>,</span><br><span class="line">        MessageCodeSpecified = <span class="literal">true</span>,</span><br><span class="line">        MessageType = <span class="string">"Save Our Souls"</span>,</span><br><span class="line">        MessageTypeSpecified = <span class="literal">true</span></span><br><span class="line">      &#125;;</span><br><span class="line">      Console.WriteLine(<span class="keyword">new</span> JsonSerializer().Serialize(message));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JSON-result-with-Specified-properties-set-true"><a href="#JSON-result-with-Specified-properties-set-true" class="headerlink" title="JSON result with Specified properties set true*"></a>JSON result with <em>Specified properties set </em>true*</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"MessageType"</span>: <span class="string">"Save Our Souls"</span>,</span><br><span class="line">  <span class="attr">"MessageTypeSpecified"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"MessageCode"</span>: <span class="number">1234567890</span>,</span><br><span class="line">  <span class="attr">"MessageCodeSpecified"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JSON-result-with-Specified-properties-set-false"><a href="#JSON-result-with-Specified-properties-set-false" class="headerlink" title="JSON result with Specified properties set false*"></a>JSON result with <em>Specified properties set </em>false*</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"MessageTypeSpecified"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"MessageCodeSpecified"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>So, this is definitely some sort of convention. I couldn’t find anything in the MSDN docs about this, or anything in the <a href="https://www.newtonsoft.com/json/help/html/Introduction.htm" target="_blank" rel="noopener">Json.NET docs</a>. Perhaps it is there <em>somewhere</em>…</p><p>Of course, if you wanted to use this feature, you would most likely hide the *Specified properties in your serialized output using an attribute.</p><p>Let me know in the comments below if you were aware of this and if you have any links to more info.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;So I had an issue at work this week with some of our serialized fields missing (and yes, I do spell serialized the American way).  Turns 
      
    
    </summary>
    
      <category term="Dev" scheme="https://jamotaylor.github.io/blog/categories/Dev/"/>
    
    
      <category term="c#" scheme="https://jamotaylor.github.io/blog/tags/c/"/>
    
      <category term="serialization" scheme="https://jamotaylor.github.io/blog/tags/serialization/"/>
    
  </entry>
  
  <entry>
    <title>Yes, sir. That&#39;s what serialization is and that&#39;s why it&#39;s such an important concept because pecans serialize an object data from one machine to another joke about a database.</title>
    <link href="https://jamotaylor.github.io/blog/2019/01/28/speech-to-text-test/"/>
    <id>https://jamotaylor.github.io/blog/2019/01/28/speech-to-text-test/</id>
    <published>2019-01-28T17:35:13.000Z</published>
    <updated>2019-02-04T13:31:58.210Z</updated>
    
    <content type="html"><![CDATA[<p>So in the process of starting this blog, I started recording some audio files while driving to and from work - the idea being to capture my thoughts and ideas while they’re still fresh in my mind. </p><p>Then, when it came to writing my first post, I went looking for software to <strong>transcribe</strong> my recordings.  To my dismay, there was nothing free out there that could transcribe from a recorded file - only from streaming speech - as in speaking into a microphone.</p><h2 id="No-problem-I’m-a-programmer-I’ll-make-my-own-transcriber"><a href="#No-problem-I’m-a-programmer-I’ll-make-my-own-transcriber" class="headerlink" title="No problem! I’m a programmer, I’ll make my own transcriber!"></a>No problem! I’m a programmer, I’ll make my own transcriber!</h2><p>Of course, by <em>“Make my own”</em>, I actually mean <em>“Go and find someone elses code that I can use”</em>…</p><p>First hit on nuget was <a href="https://www.nuget.org/packages/Google.Cloud.Speech.V1/1.1.0-beta03" target="_blank" rel="noopener"><strong><em>Google.Cloud.Speech API</em></strong></a>.  The API is pretty amazing - so simple from the C# side. Even the authentication was easy to set up and pretty much automated.  Get the beta, because it has the <em>punctuation</em> functionality and some other cool new stuff since V1.1.</p><blockquote><p>If you wanna test the API out just for fun - head to <a href="https://cloud.google.com/speech-to-text/" target="_blank" rel="noopener">this link</a> where you can upload files and see the results.  I tested it with these sounds from <a href="https://www.soundboard.com/sb/nacho_libre_movie_quotes" target="_blank" rel="noopener">Nacho Libre</a> - works a charm! 😁</p></blockquote><p>If you want to skip all the cody bits, you can go straight to the <a href="#the-results"><strong>results</strong></a> of my <em>amazing</em> test.</p><p>To be able to use the API there are a couple of things you have to do.  I’m not running through these steps in any detail because the Google Cloud console UI is pretty easy to get around and there’s also lots of <a href="https://cloud.google.com/docs/" target="_blank" rel="noopener">good documentation</a>.</p><h4 id="1-Get-a-Google-Account"><a href="#1-Get-a-Google-Account" class="headerlink" title="1. Get a Google Account"></a>1. Get a Google Account</h4><h4 id="2-Start-a-Google-Cloud-free-trial"><a href="#2-Start-a-Google-Cloud-free-trial" class="headerlink" title="2. Start a Google Cloud free trial"></a>2. Start a <a href="https:\\cloud.google.com" target="_blank" rel="noopener">Google Cloud</a> free trial</h4><ul><li>You do have to provide Credit/Debit card details but Google swear that you won’t be charged a cent until you manually activate billing. I trust them 🤷‍</li></ul><h4 id="3-Create-a-Service-Account-in-your-Google-Cloud-Console"><a href="#3-Create-a-Service-Account-in-your-Google-Cloud-Console" class="headerlink" title="3. Create a Service Account in your Google Cloud Console"></a>3. Create a Service Account in your Google Cloud Console</h4><ul><li>Give yourself the <strong>owner</strong> permission level so that you can do anything you want.</li></ul><h4 id="4-Enable-the-Cloud-Speech-API"><a href="#4-Enable-the-Cloud-Speech-API" class="headerlink" title="4. Enable the Cloud.Speech API"></a>4. Enable the Cloud.Speech API</h4><h4 id="5-Add-credentials-to-the-Cloud-Speech-API"><a href="#5-Add-credentials-to-the-Cloud-Speech-API" class="headerlink" title="5. Add credentials to the Cloud.Speech API"></a>5. Add credentials to the Cloud.Speech API</h4><h4 id="6-Download-your-credentials-as-a-JSON-file"><a href="#6-Download-your-credentials-as-a-JSON-file" class="headerlink" title="6. Download your credentials as a JSON file"></a>6. Download your credentials as a JSON file</h4><h4 id="7-Create-default-credentials-on-your-machine"><a href="#7-Create-default-credentials-on-your-machine" class="headerlink" title="7. Create default credentials on your machine"></a>7. Create default credentials on your machine</h4><p>Once you have your credentials, you need to create a environment variable that’s points the the location of the JSON file which contains your keys. They do tell you how to do this on the <a href="https://cloud.google.com/docs/authentication/getting-started" target="_blank" rel="noopener">Google Cloud docs</a>, but that didn’t work for me on my Windows 10 machine.</p><p>Instead, hit the Start key and search for “environment” - then open up the Environment Variables UI. Under the section “User Variables for [user name]” click “New…”</p><img src="/blog/2019/01/28/speech-to-text-test/google-cloud-enviro-window.png"><p>Add a variable named “GOOGLE_APPLICATION_CREDENTIALS” then click the “Browse File…” button and browse to the JSON file you’ve just downloaded.</p><img src="/blog/2019/01/28/speech-to-text-test/google-cloud-enviro-new.png"><h2 id="The-Code"><a href="#The-Code" class="headerlink" title="The Code"></a>The Code</h2><p>Now that your default credentials are loaded on your machine, you can go ahead and start writing you Unit Tests. I created a *<em>.NET Standard Class Library</em> and a <em>MSTest</em> project.  The code is really straightforward.</p><p>If you’re trying to do recognition on a large file like mine with more than 1 minute of audio then you will need to upload the file to your cloud storage. <a href="https://cloud.google.com/speech-to-text/quotas" target="_blank" rel="noopener">Read this</a> for the allowed quotas, especially the line: <em>“Audio longer than ~1 minute must use the uri field to reference an audio file in Google Cloud Storage.”</em></p><p>As you can see in the code below, I had to use the <em>LongRunningRecognize</em> method because of the file length, and I’m using the <em>FromStorageUri</em> method to retrieve the file from my cloud storage.</p><p>Notice the <em>EnableAutomaticPunctuation</em> property in the <em>RecognitionConfig</em> is set <em>true</em> - as mentioned before, this is only available in the beta.</p><p>Now you have to match your audio file type to the <em>RecognitionConfig.Encoding</em> type, and there are only <a href="https://cloud.google.com/speech-to-text/docs/encoding" target="_blank" rel="noopener">some formats</a> that the API supports.  I chose .flac basically because it’s first on the list.</p><p>I used <a href="https://audio.online-convert.com/convert-to-flac" target="_blank" rel="noopener">this service</a> to convert my MP3 to Flac and it worked really well.</p><img src="/blog/2019/01/28/speech-to-text-test/convert-flac.png"><p>Use the <em>Change the bit resolution</em> to set the bitrate to something compatible - either 16 or 24 bit. I have no idea what the sampling rate is for so I just chose 16000 Hz. Also, the API seems to only work with <em>mono</em> audio - so use the <em>Change audio channels</em> option there too.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Google.Cloud.Speech.V1;</span><br><span class="line"><span class="keyword">using</span> Google.LongRunning;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">static</span> Google.Cloud.Speech.V1.RecognitionConfig.Types;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SpeechRecordingToText</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpeechToTextTest</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">LongSpeechRecognitionTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      <span class="keyword">var</span> audio = RecognitionAudio.FromStorageUri(<span class="string">"gs://jnt-dev-speech-to-text/what is programming 2.flac"</span>);</span><br><span class="line"></span><br><span class="line">      SpeechClient client = SpeechClient.Create();</span><br><span class="line">      RecognitionConfig config = <span class="keyword">new</span> RecognitionConfig</span><br><span class="line">      &#123;</span><br><span class="line">        Encoding = AudioEncoding.Flac,</span><br><span class="line">        SampleRateHertz = <span class="number">16000</span>,</span><br><span class="line">        LanguageCode = LanguageCodes.English.UnitedStates,</span><br><span class="line">        EnableAutomaticPunctuation = <span class="literal">true</span>,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> operation = client.LongRunningRecognize(config, audio);</span><br><span class="line"></span><br><span class="line">      operation = operation.PollUntilCompleted();</span><br><span class="line"></span><br><span class="line">      LongRunningRecognizeResponse response = operation.Result;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      <span class="keyword">foreach</span> (<span class="keyword">var</span> r <span class="keyword">in</span> response.Results)</span><br><span class="line">      &#123;</span><br><span class="line">        sb.Append(r.Alternatives[<span class="number">0</span>].Transcript);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> sb.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Unit-Test"><a href="#Unit-Test" class="headerlink" title="Unit Test"></a>Unit Test</h4><p><strong>Make sure you that are running your unit tests (or IDE) as the user that you loaded the Environment Variable for, otherwise the automatic credentials won’t work.</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Microsoft.VisualStudio.TestTools.UnitTesting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Tests_SpeechToText</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">TestClass</span>]</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnitTest1</span></span><br><span class="line">  &#123;</span><br><span class="line">    [<span class="meta">TestMethod</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestMethod2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">      Console.WriteLine(<span class="keyword">new</span> SpeechRecordingToText.SpeechToTextTest().LongSpeechRecognitionTest());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="The-Results"><a href="#The-Results" class="headerlink" title="The Results"></a>The Results</h2><p>The results were… well… not my best work… it reads like the system log from Douglas Adams’ <a href="https://hitchhikers.fandom.com/wiki/Infinite_Improbability_Drive" target="_blank" rel="noopener">Infinite Improbability Drive</a>:</p><blockquote><p>Okay where we were with object-oriented sterilization? Richard knows how to do because somebody is being very active and looking a bunch of codes. Reliable Parts of tick I’m not text with you have would have the the name of my objects and then the name of the different properties of math and the value. So you have every sort of of sterilization is broken down into That things can have a name an event. And then you can have a raised you can have collections of me. So if you would take that that’s and you would converted into that she realized text and then the Peugeot I’m sending it to my friends program engine, which is considered as an object in that language. Where’s my pregnant? in the programming languages, but they are just in the world of the okay. Yes, sir. That’s what serialization is and that’s why it’s such an important concept because pecans serialize an object data from one machine to another joke about a database. It’s a fairly similar will be used to seeing fall of data stored on. On your computer on your desktop simplest form of dates that you can really look at windows. all the equivalent in Mac You’ll see the file extension. Txt. And you got some inside. What do bestie done GIF created a Text document that contains Unicode characters, which is that mapping. I was talking about earlier and each one of those characters is coming in 56. So 10 words would be one box. I-10 code four cases of be about 1 bucks best and that’s a simple fall so you can that is called that is how it is stored in a file and it’s cold and encoding to tell that day too hot. ohashi written and read in most cases it will be difficult to answer Unicode characters in a text file and now you can imagine that’s if I’ve got a Word document when you open a Word document, that’s because Microsoft Word Is there any how to open that kind of file She tried to open a Word document. with a notepad Doesn’t know how to read a Word document. So you going to see a whole bunch of crazy characters that is trying to trying to convert binary data to text and it’s saying what does value to text. It’s out of the range of values that I’m expecting and so I’m just going to put this blockia. character use files full everything Play in memory on your hard drive. Quiznos the five star I’m all it does is read that file from beginning to end and that’s how you end up with Violin Memory. Databases you might have heard of file to sterilize everything to so much more efficient in SQL Server. It breaks the dead up into very efficient little Cloud Supreme them together. That’s basically like its own file system. and time is it? Can I get a full tank but just the first pick? Nike what the fastest what’s the what’s the difference? What’s the where’s the process? Okay. Okay, it’s not a big difference. But if you just a fish stick images, it’s not my car.</p></blockquote><p>At least it was fun.  Looks like I’ll just have to transcribe all those notes myself…  </p><p>Hey, on the plus side - this is kinda why we start with Unit Tests right?</p><p>It amazes me how easy to integrate this whole API was - and maybe I’ll get a chance to come back to this sometime and play around some more… I’ve still got $300 to spend this year!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;So in the process of starting this blog, I started recording some audio files while driving to and from work - the idea being to capture 
      
    
    </summary>
    
      <category term="Dev" scheme="https://jamotaylor.github.io/blog/categories/Dev/"/>
    
    
      <category term="c#" scheme="https://jamotaylor.github.io/blog/tags/c/"/>
    
      <category term="random" scheme="https://jamotaylor.github.io/blog/tags/random/"/>
    
  </entry>
  
</feed>
